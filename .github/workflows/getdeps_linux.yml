# This file was @generated by getdeps.py

name: linux

on:
  push:
    branches:
    - master
  pull_request:
    branches:
    - master

jobs:
  build:
    runs-on: ubuntu-18.04
    env:
      GITHUB_ACTION_ARTIFACT_CACHE: /tmp/getdeps-cache
    steps:
    - uses: actions/checkout@v1
    - name: Cache multiple paths
      uses: actions/cache@v2
      with:
        path: |
          /tmp/getdeps-cache
        key: ${{ runner.os }}-${{ hashFiles('build/fbcode_builder/manifests/*') }}
        restore-keys: |
          ${{ runner.os }}-${{ hashFiles('build/fbcode_builder/manifests/*') }}-1
          ${{ runner.os }}-
    - name: Fetch boost
      run: python3 build/fbcode_builder/getdeps.py fetch --no-tests boost
    - name: Fetch ninja
      run: python3 build/fbcode_builder/getdeps.py fetch --no-tests ninja
    - name: Fetch cmake
      run: python3 build/fbcode_builder/getdeps.py fetch --no-tests cmake
    - name: Fetch cpptoml
      run: python3 build/fbcode_builder/getdeps.py fetch --no-tests cpptoml
    - name: Fetch googletest
      run: python3 build/fbcode_builder/getdeps.py fetch --no-tests googletest
    - name: Fetch pcre
      run: python3 build/fbcode_builder/getdeps.py fetch --no-tests pcre
    - name: Fetch fmt
      run: python3 build/fbcode_builder/getdeps.py fetch --no-tests fmt
    - name: Fetch python-six
      run: python3 build/fbcode_builder/getdeps.py fetch --no-tests python-six
    - name: Fetch zstd
      run: python3 build/fbcode_builder/getdeps.py fetch --no-tests zstd
    - name: Fetch double-conversion
      run: python3 build/fbcode_builder/getdeps.py fetch --no-tests double-conversion
    - name: Fetch gflags
      run: python3 build/fbcode_builder/getdeps.py fetch --no-tests gflags
    - name: Fetch glog
      run: python3 build/fbcode_builder/getdeps.py fetch --no-tests glog
    - name: Fetch libevent
      run: python3 build/fbcode_builder/getdeps.py fetch --no-tests libevent
    - name: Fetch lz4
      run: python3 build/fbcode_builder/getdeps.py fetch --no-tests lz4
    - name: Fetch snappy
      run: python3 build/fbcode_builder/getdeps.py fetch --no-tests snappy
    - name: Fetch folly
      run: python3 build/fbcode_builder/getdeps.py fetch --no-tests folly
    - name: Fetch autoconf
      run: python3 build/fbcode_builder/getdeps.py fetch --no-tests autoconf
    - name: Fetch automake
      run: python3 build/fbcode_builder/getdeps.py fetch --no-tests automake
    - name: Fetch libtool
      run: python3 build/fbcode_builder/getdeps.py fetch --no-tests libtool
    - name: Fetch bison
      run: python3 build/fbcode_builder/getdeps.py fetch --no-tests bison
    - name: Fetch libsodium
      run: python3 build/fbcode_builder/getdeps.py fetch --no-tests libsodium
    - name: Fetch fizz
      run: python3 build/fbcode_builder/getdeps.py fetch --no-tests fizz
    - name: Fetch flex
      run: python3 build/fbcode_builder/getdeps.py fetch --no-tests flex
    - name: Fetch wangle
      run: python3 build/fbcode_builder/getdeps.py fetch --no-tests wangle
    - name: Fetch fbthrift
      run: python3 build/fbcode_builder/getdeps.py fetch --no-tests fbthrift
    - name: Fetch fb303
      run: python3 build/fbcode_builder/getdeps.py fetch --no-tests fb303
    - name: Build boost
      run: python3 build/fbcode_builder/getdeps.py build --schedule-type continuous --no-tests boost
    - name: Build ninja
      run: python3 build/fbcode_builder/getdeps.py build --schedule-type continuous --no-tests ninja
    - name: Build cmake
      run: python3 build/fbcode_builder/getdeps.py build --schedule-type continuous --no-tests cmake
    - name: Build cpptoml
      run: python3 build/fbcode_builder/getdeps.py build --schedule-type continuous --no-tests cpptoml
    - name: Build googletest
      run: python3 build/fbcode_builder/getdeps.py build --schedule-type continuous --no-tests googletest
    - name: Build pcre
      run: python3 build/fbcode_builder/getdeps.py build --schedule-type continuous --no-tests pcre
    - name: Build fmt
      run: python3 build/fbcode_builder/getdeps.py build --schedule-type continuous --no-tests fmt
    - name: Build python-six
      run: python3 build/fbcode_builder/getdeps.py build --schedule-type continuous --no-tests python-six
    - name: Build zstd
      run: python3 build/fbcode_builder/getdeps.py build --schedule-type continuous --no-tests zstd
    - name: Build double-conversion
      run: python3 build/fbcode_builder/getdeps.py build --schedule-type continuous --no-tests double-conversion
    - name: Build gflags
      run: python3 build/fbcode_builder/getdeps.py build --schedule-type continuous --no-tests gflags
    - name: Build glog
      run: python3 build/fbcode_builder/getdeps.py build --schedule-type continuous --no-tests glog
    - name: Build libevent
      run: python3 build/fbcode_builder/getdeps.py build --schedule-type continuous --no-tests libevent
    - name: Build lz4
      run: python3 build/fbcode_builder/getdeps.py build --schedule-type continuous --no-tests lz4
    - name: Build snappy
      run: python3 build/fbcode_builder/getdeps.py build --schedule-type continuous --no-tests snappy
    - name: Build folly
      run: python3 build/fbcode_builder/getdeps.py build --schedule-type continuous --no-tests folly
    - name: Build autoconf
      run: python3 build/fbcode_builder/getdeps.py build --schedule-type continuous --no-tests autoconf
    - name: Build automake
      run: python3 build/fbcode_builder/getdeps.py build --schedule-type continuous --no-tests automake
    - name: Build libtool
      run: python3 build/fbcode_builder/getdeps.py build --schedule-type continuous --no-tests libtool
    - name: Build bison
      run: python3 build/fbcode_builder/getdeps.py build --schedule-type continuous --no-tests bison
    - name: Build libsodium
      run: python3 build/fbcode_builder/getdeps.py build --schedule-type continuous --no-tests libsodium
    - name: Build fizz
      run: python3 build/fbcode_builder/getdeps.py build --schedule-type continuous --no-tests fizz
    - name: Build flex
      run: python3 build/fbcode_builder/getdeps.py build --schedule-type continuous --no-tests flex
    - name: Build wangle
      run: python3 build/fbcode_builder/getdeps.py build --schedule-type continuous --no-tests wangle
    - name: Build fbthrift
      run: python3 build/fbcode_builder/getdeps.py build --schedule-type continuous --no-tests fbthrift
    - name: Build fb303
      run: python3 build/fbcode_builder/getdeps.py build --schedule-type continuous --no-tests fb303
    - name: Build watchman
      run: python3 build/fbcode_builder/getdeps.py build --schedule-type continuous --src-dir=. watchman  --project-install-prefix watchman:/usr/local
    - name: Copy artifacts
      run: python3 build/fbcode_builder/getdeps.py fixup-dyn-deps --strip --src-dir=. watchman _artifacts/linux  --project-install-prefix watchman:/usr/local --final-install-prefix /usr/local
    - uses: actions/upload-artifact@master
      with:
        name: watchman
        path: _artifacts
    - name: Test watchman
      run: python3 build/fbcode_builder/getdeps.py test --src-dir=. watchman  --project-install-prefix watchman:/usr/local
