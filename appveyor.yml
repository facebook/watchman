version: b{build}
configuration:
  - Release

os: Visual Studio 2017

branches:
  except:
    - gh-pages

init:
  - SET PATH=c:\python37-x64;C:\OpenSSL-win64;%PATH%
  - SET ANSICON=121x90 (121x90)

install:
  - python -V

build_script:
  - cmd: python build/fbcode_builder/getdeps.py build watchman --num-jobs=2

test_script:
  - "cd node && npm install"
  - cmd: python build/fbcode_builder/getdeps.py test watchman --num-jobs=2
#  - cmd: mkdir Watchman
#  - cmd: copy Release\watchman.exe Watchman
#  - cmd: copy Release\watchman.pdb Watchman
#  - cmd: copy LICENSE Watchman/LICENSE.txt
#  - cmd: copy README.markdown Watchman
#  - cmd: python winbuild\copy-dyn-deps.py Release\watchman.exe Watchman c:\tools\vcpkg\installed\x64-windows\bin external\install\bin external\install\lib
#  - cmd: python runtests.py --watchman-path Release\watchman.exe --concurrency=1
#  - cmd: ctest -C Release --output-on-failure
#  - cmd: python runtests.py --watchman-path Release\watchman.exe --concurrency=1 --win7

#artifacts:
#  - path: watchman
#    name: watchman
#    type: zip

environment:
  #global:
  #  WATCHMAN_BINARY: Release/watchman.exe
    #BOOST_ROOT: C:/Libraries/boost_1_67_0
    #LIBEVENT_INCLUDE_DIR: C:/projects/watchman/external/install/include
    #LIBEVENT_LIB: C:/projects/watchman/external/install/lib
  # We don't really need the matrix any more, but the windows download link
  # from the web site references this particular build flavor.  So we keep
  # this one here until we've landed this and cut over the download URL.
  matrix:
    - WATCHMAN_WIN7_COMPAT:

platform:
  - x64
