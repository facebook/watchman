<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus">


<title data-react-helmet="true">File Queries | Watchman</title>

<meta data-react-helmet="true" http-equiv="x-ua-compatible" content="ie=edge"><meta data-react-helmet="true" property="og:title" content="Watchman"><meta data-react-helmet="true" name="twitter:card" content="summary"><meta data-react-helmet="true" name="description" content="Watchman file queries consist of 1 or more _generators_ that feed files"><meta data-react-helmet="true" property="og:description" content="Watchman file queries consist of 1 or more _generators_ that feed files"><meta data-react-helmet="true" property="og:url" content="https://facebook.github.io/watchman/docs/file-query">

<link data-react-helmet="true" rel="shortcut icon" href="/watchman/img/favicon.png">


<link rel="stylesheet" href="/watchman/styles.c3aaf29d.css">


<link rel="preload" href="/watchman/styles.97c84ccd.js" as="script">

<link rel="preload" href="/watchman/runtime~main.3c31e0d3.js" as="script">

<link rel="preload" href="/watchman/main.d06ec8f8.js" as="script">

<link rel="preload" href="/watchman/1.7ee19611.js" as="script">

<link rel="preload" href="/watchman/68.bb6e8a82.js" as="script">

<link rel="preload" href="/watchman/d6764f29.cb344075.js" as="script">

<link rel="preload" href="/watchman/17896441.7cf0bc6a.js" as="script">

<link rel="preload" href="/watchman/71e436a3.9b17064b.js" as="script">

</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script>
<div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a aria-current="page" class="navbar__brand active" href="/watchman/"><img class="navbar__logo" src="/watchman/img/logo.png" alt="Watchman Logo"><strong class="navbar__title">Watchman</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/watchman/docs/install">Docs</a><a class="navbar__item navbar__link" href="/watchman/docs/support">Support</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" target="_blank" rel="noopener noreferrer" href="https://github.com/facebook/watchman">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a aria-current="page" class="navbar__brand active" href="/watchman/"><img class="navbar__logo" src="/watchman/img/logo.png" alt="Watchman Logo"><strong class="navbar__title">Watchman</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/watchman/docs/install">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/watchman/docs/support">Support</a></li><li class="menu__list-item"><a class="menu__link" target="_blank" rel="noopener noreferrer" href="https://github.com/facebook/watchman">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><div class="docSidebarContainer_1cYp"><div class="sidebar_1kLs"><div class="sidebarLogo_3ono"><img src="/watchman/img/logo.png" alt="Watchman Logo"><strong>Watchman</strong></div><div class="menu menu--responsive menu_w2sC"><button aria-label="Open Menu" class="button button--secondary button--sm menu__button" type="button"><svg class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Installation</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/watchman/docs/install">Installation</a></li><li class="menu__list-item"><a class="menu__link" href="/watchman/docs/release-notes">Release Notes</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Invocation</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/watchman/docs/cli-options">Command Line</a></li><li class="menu__list-item"><a class="menu__link" href="/watchman/docs/watchman-make">watchman-make</a></li><li class="menu__list-item"><a class="menu__link" href="/watchman/docs/watchman-wait">watchman-wait</a></li><li class="menu__list-item"><a class="menu__link" href="/watchman/docs/watchman-replicate-subscription">watchman-replicate-subscription</a></li><li class="menu__list-item"><a class="menu__link" href="/watchman/docs/cppclient">C++ Client</a></li><li class="menu__list-item"><a class="menu__link" href="/watchman/docs/nodejs">NodeJS</a></li><li class="menu__list-item"><a class="menu__link" href="/watchman/docs/config">Configuration Files</a></li><li class="menu__list-item"><a class="menu__link" href="/watchman/docs/socket-interface">Socket Interface</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Compatibility</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/watchman/docs/compatibility">Compatibility Rules</a></li><li class="menu__list-item"><a class="menu__link" href="/watchman/docs/capabilities">Capabilities</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Commands</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/watchman/docs/find">find</a></li><li class="menu__list-item"><a class="menu__link" href="/watchman/docs/flush-subscriptions">flush-subscriptions</a></li><li class="menu__list-item"><a class="menu__link" href="/watchman/docs/get-config">get-config</a></li><li class="menu__list-item"><a class="menu__link" href="/watchman/docs/get-sockname">get-sockname</a></li><li class="menu__list-item"><a class="menu__link" href="/watchman/docs/list-capabilities">list-capabilities</a></li><li class="menu__list-item"><a class="menu__link" href="/watchman/docs/log">log</a></li><li class="menu__list-item"><a class="menu__link" href="/watchman/docs/log-level">log-level</a></li><li class="menu__list-item"><a class="menu__link" href="/watchman/docs/query">query</a></li><li class="menu__list-item"><a class="menu__link" href="/watchman/docs/shutdown-server">shutdown-server</a></li><li class="menu__list-item"><a class="menu__link" href="/watchman/docs/since">since</a></li><li class="menu__list-item"><a class="menu__link" href="/watchman/docs/state-enter">state-enter</a></li><li class="menu__list-item"><a class="menu__link" href="/watchman/docs/state-leave">state-leave</a></li><li class="menu__list-item"><a class="menu__link" href="/watchman/docs/subscribe">subscribe</a></li><li class="menu__list-item"><a class="menu__link" href="/watchman/docs/trigger">trigger</a></li><li class="menu__list-item"><a class="menu__link" href="/watchman/docs/trigger-del">trigger-del</a></li><li class="menu__list-item"><a class="menu__link" href="/watchman/docs/trigger-list">trigger-list</a></li><li class="menu__list-item"><a class="menu__link" href="/watchman/docs/unsubscribe">unsubscribe</a></li><li class="menu__list-item"><a class="menu__link" href="/watchman/docs/version">version</a></li><li class="menu__list-item"><a class="menu__link" href="/watchman/docs/watch">watch</a></li><li class="menu__list-item"><a class="menu__link" href="/watchman/docs/watch-del">watch-del</a></li><li class="menu__list-item"><a class="menu__link" href="/watchman/docs/watch-del-all">watch-del-all</a></li><li class="menu__list-item"><a class="menu__link" href="/watchman/docs/watch-list">watch-list</a></li><li class="menu__list-item"><a class="menu__link" href="/watchman/docs/watch-project">watch-project</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Queries</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/watchman/docs/clockspec">Clockspec</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/watchman/docs/file-query">File Queries</a></li><li class="menu__list-item"><a class="menu__link" href="/watchman/docs/simple-query">Simple Pattern Syntax</a></li><li class="menu__list-item"><a class="menu__link" href="/watchman/docs/scm-query">Source Control Aware Queries</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Expressions Terms</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/watchman/docs/allof">allof</a></li><li class="menu__list-item"><a class="menu__link" href="/watchman/docs/anyof">anyof</a></li><li class="menu__list-item"><a class="menu__link" href="/watchman/docs/dirname">dirname &amp; idirname</a></li><li class="menu__list-item"><a class="menu__link" href="/watchman/docs/empty">empty</a></li><li class="menu__list-item"><a class="menu__link" href="/watchman/docs/exists">exists</a></li><li class="menu__list-item"><a class="menu__link" href="/watchman/docs/match">match &amp; imatch</a></li><li class="menu__list-item"><a class="menu__link" href="/watchman/docs/name">name &amp; iname</a></li><li class="menu__list-item"><a class="menu__link" href="/watchman/docs/not">not</a></li><li class="menu__list-item"><a class="menu__link" href="/watchman/docs/pcre">pcre &amp; ipcre</a></li><li class="menu__list-item"><a class="menu__link" href="/watchman/docs/exp-since">since</a></li><li class="menu__list-item"><a class="menu__link" href="/watchman/docs/size">size</a></li><li class="menu__list-item"><a class="menu__link" href="/watchman/docs/suffix">suffix</a></li><li class="menu__list-item"><a class="menu__link" href="/watchman/docs/type">type</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Internals</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/watchman/docs/bser">BSER Binary Protocol</a></li><li class="menu__list-item"><a class="menu__link" href="/watchman/docs/casefolding">Case-Insensitivity</a></li><li class="menu__list-item"><a class="menu__link" href="/watchman/docs/contributing">Contributing</a></li><li class="menu__list-item"><a class="menu__link" href="/watchman/docs/cookies">Query Synchronization</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Troubleshooting</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/watchman/docs/troubleshooting">Troubleshooting</a></li></ul></li></ul></div></div></div><main class="docMainContainer_FFX1"><div class="padding-vert--lg"><div class="container"><div class="row"><div class="col docItemCol_2GOA"><div class="docItemContainer_2cwg"><article><header><h1 class="docTitle_1vWb">File Queries</h1></header><div class="markdown"><p>Watchman file queries consist of 1 or more <em>generators</em> that feed files
through the <em>expression evaluator</em>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="generators"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#generators" title="Direct link to heading">#</a>Generators</h3><p>Generators are analogous to the list of <em>paths</em> that you specify when using
the <code>find(1)</code> utility, but are implemented in watchman with a bit of a twist
because watchman doesn&#x27;t need to crawl the filesystem in realtime and instead
maintains a couple of indexes over the tree.</p><p>A query may specify any number of generators; each generator will emit its
list of files and this may mean that you see the same file output more than
once if you specified the use of multiple generators that all produce the same
file.</p><p>Watchman provides 5 generators:</p><ul><li><strong>since</strong>: produces a list of files that were modified since a specific
clockspec.</li><li><strong>suffix</strong>: produces a list of files that have a particular suffix.</li><li><strong>glob</strong>: efficiently pattern match a list of files based on their names.</li><li><strong>path</strong>: produces a list of files based on their path and depth.</li><li><strong>all</strong>: produces a list of all known files</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="de-duplicating-results"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#de-duplicating-results" title="Direct link to heading">#</a>De-duplicating results</h3><p><em>Since 4.7.</em></p><p>If your query uses multiple generators, or configures the <code>path</code> generator
with paths that yield multiple results, the default behavior (for backwards
compatibility reasons) is to emit those duplicate results in the query output.</p><p>You may ask Watchman to de-duplicate results for you by enabling the
<code>dedup_results</code> boolean in your query:</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-undefined codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ watchman -j &lt;&lt;-EOT</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[&quot;query&quot;, &quot;/path/to/root&quot;, {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;path&quot;: [&quot;bar&quot;, &quot;bar&quot;],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;dedup_results&quot;: true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">EOT</span></div></code></pre></div><p>You may test for this feature using an extended version command and requesting
the capability name <code>dedup_results</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="since-generator"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#since-generator" title="Direct link to heading">#</a>Since Generator</h3><p>The <code>since</code> generator produces a list of files that were modified since a
specific <a href="clockspec">clockspec</a>.</p><p>The following query will consider the set of files changed since the last
query using the named cursor <code>mycursor</code> and then pass them to the expression
evaluator to be filtered to just those that are files:</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-bash codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ watchman -j </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;&lt;-</span><span class="token string" style="color:rgb(195, 232, 141)">EOT</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">[&quot;query&quot;, &quot;/path/to/root&quot;, {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">  &quot;since&quot;: &quot;n:mycursor&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">  &quot;expression&quot;: [&quot;type&quot;, &quot;f&quot;]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">}]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">EOT</span></div></code></pre></div><p>If the <code>since</code> parameter value is blank, was produced by a different watchman
process (in other words, the watchman process was restarted between the time
that the value was obtained and the time the query was issued) or is a named
cursor that has not yet been used in a query, the <code>since</code> generator will
consider the state to be a <em>fresh instance</em> and its behavior is modified:</p><p>A <em>fresh instance</em> result set will only include files that currently exist and
will generate file nodes that are always considered to be <code>new</code>.</p><p>If the query was configured with the <code>empty_on_fresh_instance</code> property set to
<code>true</code> then the result set will be empty and the <code>is_fresh_instance</code> property
will be set to <code>true</code> in the result object.</p><p>The since generator also knows how to talk to source control;
<a href="scm-query">you can read more about that here</a>.</p><p>The <code>since</code> generator does not consider the targets of symlinks. In
particular, the <code>since</code> generator may <em>not</em> produce a symlink in the following
cases:</p><ul><li>The symlink&#x27;s target was a file, and the file is since modified.</li><li>The symlink&#x27;s target was a file, and the file is since deleted or replaced
with a different file.</li><li>An ancestor of the symlink&#x27;s target was created or deleted or modified.</li><li>The symlink&#x27;s target was a directory, and a file is since added or removed
from that directory.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="suffix-generator"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#suffix-generator" title="Direct link to heading">#</a>Suffix Generator</h3><p>The <code>suffix</code> generator produces a list of files that have a particular suffix
or set of suffixes. The value can be either a string or an array of strings.</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-bash codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ watchman -j </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;&lt;-</span><span class="token string" style="color:rgb(195, 232, 141)">EOT</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">[&quot;query&quot;, &quot;/path/to/root&quot;, {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">  &quot;suffix&quot;: &quot;js&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">}]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">EOT</span></div></code></pre></div><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-bash codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ watchman -j </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;&lt;-</span><span class="token string" style="color:rgb(195, 232, 141)">EOT</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">[&quot;query&quot;, &quot;/path/to/root&quot;, {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">  &quot;suffix&quot;: [&quot;js&quot;, &quot;css&quot;]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">}]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">EOT</span></div></code></pre></div><p>If the <code>suffix</code> generator is given an empty array, it produces no files.</p><p>The <code>suffix</code> generator can produce symlinks.</p><p>The <code>suffix</code> generator does not follow symlinks. For example, a symlink to
<code>/etc</code> will not cause a <code>&quot;suffix&quot;: &quot;conf&quot;</code> query to search within <code>/etc</code> and
produce <code>/etc/resolv.conf</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="glob-generator"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#glob-generator" title="Direct link to heading">#</a>Glob Generator</h3><p><em>Since 4.7.</em></p><p>The <code>glob</code> generator produces a list of files by matching against your input
list of patterns. It does this by building a tree from the glob expression(s)
and walking both the expression and the in-memory filesystem tree
concurrently.</p><p>This query will yield a list of all of the C source and header files found
directly in the <code>src</code> dir:</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-undefined codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ watchman -j &lt;&lt;-EOT</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[&quot;query&quot;, &quot;/path/to/root&quot;, {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;glob&quot;: [&quot;src/*.c&quot;, &quot;src/*.h&quot;],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;fields&quot;: [&quot;name&quot;]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}]</span></div></code></pre></div><p>This query will yield a list of all of the C source and header files found in
any subdirectories of the root:</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-undefined codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ watchman -j &lt;&lt;-EOT</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[&quot;query&quot;, &quot;/path/to/root&quot;, {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;glob&quot;: [&quot;**/*.c&quot;, &quot;**/*.h&quot;],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;fields&quot;: [&quot;name&quot;]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}]</span></div></code></pre></div><p>Note that it is more efficient to use the <code>suffix</code> generator together with a
<code>dirname</code> expression term for such a broadly scoped query as it results in
fewer comparisons. This example is included as an illustration of recursive
globbing.</p><p>The glob generator implicitly enables <code>dedup_results</code> mode.</p><p>If the <code>glob</code> generator is given an empty array, it produces no files.</p><p>The <code>glob</code> generator can produce symlinks.</p><p>The <code>glob</code> generator does not follow symlinks. For example, a symlink to
<code>/etc</code> will not cause a <code>&quot;glob&quot;: [&quot;**/resolv.conf&quot;]</code> query to search within
<code>/etc</code> and produce <code>/etc/resolv.conf</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="path-generator"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#path-generator" title="Direct link to heading">#</a>Path Generator</h3><p>The <code>path</code> generator produces a list of files based on their path and depth.
Depth controls how far watchman will search down the directory tree for files.</p><p>The <code>path</code> generator expects an array of path specifiers. Each path specifier
can be either a string or an object and each will produce a set of files.</p><p>If it is a string then it is treated as the value for <code>path</code> with <code>depth</code> set
to infinite. If an object, the fields <code>path</code> (a string) and <code>depth</code> (an
integer) must be supplied.</p><p>Paths are relative to the root, so if watchman is watching <code>/foo/</code>, path <code>bar</code>
refers to <code>/foo/bar</code>.</p><p>A <code>depth</code> value of <code>0</code> means only files and directories which are contained in
this path. A <code>depth</code> value of <code>-1</code> means no limit on the depth.</p><p>The following <code>path</code> generators are equivalent:</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-undefined codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ watchman -j &lt;&lt;-EOT</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[&quot;query&quot;, &quot;/path/to/root&quot;, {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;path&quot;: [&quot;bar&quot;]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">EOT</span></div></code></pre></div><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-undefined codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ watchman -j &lt;&lt;-EOT</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[&quot;query&quot;, &quot;/path/to/root&quot;, {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;path&quot;: [{&quot;path&quot;: &quot;bar&quot;, &quot;depth&quot;: -1}]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">EOT</span></div></code></pre></div><p>If the <code>path</code> generator is given an empty array, it produces no files.</p><p>The <code>path</code> generator can produce symlinks.</p><p>The <code>path</code> generator does not follow symlinks.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="all-generator"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#all-generator" title="Direct link to heading">#</a>All Generator</h3><p>The <code>all</code> generator produces a list of all file nodes. It is the default
generator and is used in the case where no other generators were explicitly
specified.</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-bash codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ watchman -j </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;&lt;-</span><span class="token string" style="color:rgb(195, 232, 141)">EOT</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">[&quot;query&quot;, &quot;/path/to/root&quot;, {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">}]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">EOT</span></div></code></pre></div><p>The <code>all</code> generator can produce symlinks.</p><p>The <code>all</code> generator does not follow symlinks.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="expressions"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#expressions" title="Direct link to heading">#</a>Expressions</h3><p>A watchman query expression consists of 0 or more expression terms. If no
terms are provided then each file evaluated is considered a match (equivalent
to specifying a single <code>true</code> expression term).</p><p>Otherwise, the expression is evaluated against the file and produces a boolean
result. If that result is true then the file is considered a match and is
added to the output set.</p><p>An expression term is canonically represented as a JSON array whose zeroth
element is a string containing the term name.</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-json codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;termname&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> arg</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> arg</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span></div></code></pre></div><p>If the term accepts no arguments you may use a short form that consists of
just the term name expressed as a string:</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-json codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">&quot;true&quot;</span></div></code></pre></div><p>Expressions that match against file names may match against either the
<em>basename</em> or the <em>wholename</em> of the file. The basename is the name of the
file within its containing directory. The wholename is the name of the file
relative to the watched root.</p><p>You can find a list of all possible expression terms in the sidebar on the
left of this page.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="relative-roots"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#relative-roots" title="Direct link to heading">#</a>Relative roots</h3><p><em>Since 3.3.</em></p><p>Watchman supports optionally evaluating queries with respect to a path within
a watched root. This is used with the <code>relative_root</code> parameter:</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-json codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;query&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;/path/to/watched/root&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;relative_root&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;project1&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span></div></code></pre></div><p>Setting a relative root results in the following modifications to queries:</p><ul><li>The <code>path</code> generator is evaluated with respect to the relative root. In the
above example, <code>&quot;path&quot;: [&quot;dir&quot;]</code> will return all files inside
<code>/path/to/watched/root/project1/dir</code>.</li><li>The input expression is evaluated with respect to the relative root. In the
above example, <code>&quot;expression&quot;: [&quot;match&quot;, &quot;dir/*.txt&quot;, &quot;wholename&quot;]</code> will
return all files inside <code>/path/to/watched/root/project1/dir/</code> that match the
glob <code>*.txt</code>.</li><li>Paths inside the relative root are returned with the relative root stripped
off. For example, a path <code>project1/dir/file.txt</code> would be returned as
<code>dir/file.txt</code>.</li><li>Paths outside the relative root are not returned.</li></ul><p>Relative roots behave similarly to a separate Watchman watch on the
subdirectory, without any of the system overhead that that imposes. This is
useful for large repositories, where your script or tool is only interested in
a particular directory inside the repository.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/facebook/watchman/edit/master/website/docs/file-query.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/watchman/docs/clockspec"><h5 class="pagination-nav__link--sublabel">Previous</h5><h4 class="pagination-nav__link--label">« Clockspec</h4></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/watchman/docs/simple-query"><h5 class="pagination-nav__link--sublabel">Next</h5><h4 class="pagination-nav__link--label">Simple Pattern Syntax »</h4></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="contents contents__left-border"><li><a href="#generators" class="contents__link">Generators</a></li><li><a href="#de-duplicating-results" class="contents__link">De-duplicating results</a></li><li><a href="#since-generator" class="contents__link">Since Generator</a></li><li><a href="#suffix-generator" class="contents__link">Suffix Generator</a></li><li><a href="#glob-generator" class="contents__link">Glob Generator</a></li><li><a href="#path-generator" class="contents__link">Path Generator</a></li><li><a href="#all-generator" class="contents__link">All Generator</a></li><li><a href="#expressions" class="contents__link">Expressions</a></li><li><a href="#relative-roots" class="contents__link">Relative roots</a></li></ul></div></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="text--center"><div class="margin-bottom--sm"><a href="https://opensource.facebook.com/" target="_blank" rel="noopener noreferrer" class="footerLogoLink_1Wg7"><img class="footer__logo" alt="Facebook Open Source Logo" src="/watchman/img/oss_logo.png"></a></div><div>Copyright © 2020 Facebook, Inc. Built with Docusaurus.</div></div></div></footer>
</div>

<script src="/watchman/styles.97c84ccd.js"></script>

<script src="/watchman/runtime~main.3c31e0d3.js"></script>

<script src="/watchman/main.d06ec8f8.js"></script>

<script src="/watchman/1.7ee19611.js"></script>

<script src="/watchman/68.bb6e8a82.js"></script>

<script src="/watchman/d6764f29.cb344075.js"></script>

<script src="/watchman/17896441.7cf0bc6a.js"></script>

<script src="/watchman/71e436a3.9b17064b.js"></script>


</body>
</html>