<html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>watchman | A file watching service</title><meta name="viewport" content="width=device-width"><meta property="og:title" content="watchman | A file watching service"><meta property="og:type" content="website"><meta property="og:url" content="http:&#x2f;&#x2f;facebook.github.io&#x2f;watchman&#x2f;index.html"><meta property="og:image" content="http:&#x2f;&#x2f;facebook.github.io&#x2f;watchman&#x2f;favicon.png"><meta property="og:description" content="A file watching service"><link rel="shortcut icon" href="&#x2f;watchman&#x2f;img&#x2f;favicon.png"><link rel="stylesheet" href="&#x2f;watchman&#x2f;css&#x2f;watchman.css"><script type="text&#x2f;javascript" src="&#x2f;&#x2f;use.typekit.net&#x2f;vqa1hcx.js"></script><script type="text&#x2f;javascript">try{Typekit.load();}catch(e){}</script></head><body><div class="container"><div class="nav-main"><div class="wrap"><a class="nav-home" href="&#x2f;watchman&#x2f;">watchman</a><ul class="nav-site"><li><a href="&#x2f;watchman&#x2f;docs&#x2f;install.html" class="active">docs</a></li><li><a href="&#x2f;watchman&#x2f;support.html" class="">support</a></li><li><a href="http:&#x2f;&#x2f;github.com&#x2f;facebook&#x2f;watchman" class="">github</a></li></ul></div></div><section class="content wrap documentationContent"><div class="nav-docs"><div class="nav-docs-section"><h3>Installation</h3><ul><li><a style="margin-left:0;" class="" href="&#x2f;watchman&#x2f;docs&#x2f;install.html">Installation</a></li></ul></div><div class="nav-docs-section"><h3>Invocation</h3><ul><li><a style="margin-left:0;" class="" href="&#x2f;watchman&#x2f;docs&#x2f;cli-options.html">Command Line</a></li><li><a style="margin-left:0;" class="" href="&#x2f;watchman&#x2f;docs&#x2f;config.html">Configuration Files</a></li><li><a style="margin-left:0;" class="" href="&#x2f;watchman&#x2f;docs&#x2f;socket-interface.html">Socket Interface</a></li></ul></div><div class="nav-docs-section"><h3>Commands</h3><ul><li><a style="margin-left:0;" class="" href="&#x2f;watchman&#x2f;docs&#x2f;cmd&#x2f;clock.html">clock</a></li><li><a style="margin-left:0;" class="" href="&#x2f;watchman&#x2f;docs&#x2f;cmd&#x2f;find.html">find</a></li><li><a style="margin-left:0;" class="" href="&#x2f;watchman&#x2f;docs&#x2f;cmd&#x2f;get-config.html">get-config</a></li><li><a style="margin-left:0;" class="" href="&#x2f;watchman&#x2f;docs&#x2f;cmd&#x2f;get-sockname.html">get-sockname</a></li><li><a style="margin-left:0;" class="" href="&#x2f;watchman&#x2f;docs&#x2f;cmd&#x2f;log.html">log</a></li><li><a style="margin-left:0;" class="" href="&#x2f;watchman&#x2f;docs&#x2f;cmd&#x2f;log-level.html">log-level</a></li><li><a style="margin-left:0;" class="" href="&#x2f;watchman&#x2f;docs&#x2f;cmd&#x2f;query.html">query</a></li><li><a style="margin-left:0;" class="" href="&#x2f;watchman&#x2f;docs&#x2f;cmd&#x2f;shutdown-server.html">shutdown-server</a></li><li><a style="margin-left:0;" class="" href="&#x2f;watchman&#x2f;docs&#x2f;cmd&#x2f;since.html">since</a></li><li><a style="margin-left:0;" class="" href="&#x2f;watchman&#x2f;docs&#x2f;cmd&#x2f;subscribe.html">subscribe</a></li><li><a style="margin-left:0;" class="" href="&#x2f;watchman&#x2f;docs&#x2f;cmd&#x2f;trigger.html">trigger</a></li><li><a style="margin-left:0;" class="" href="&#x2f;watchman&#x2f;docs&#x2f;cmd&#x2f;trigger-del.html">trigger-del</a></li><li><a style="margin-left:0;" class="" href="&#x2f;watchman&#x2f;docs&#x2f;cmd&#x2f;trigger-list.html">trigger-list</a></li><li><a style="margin-left:0;" class="" href="&#x2f;watchman&#x2f;docs&#x2f;cmd&#x2f;unsubscribe.html">unsubscribe</a></li><li><a style="margin-left:0;" class="" href="&#x2f;watchman&#x2f;docs&#x2f;cmd&#x2f;version.html">version</a></li><li><a style="margin-left:0;" class="" href="&#x2f;watchman&#x2f;docs&#x2f;cmd&#x2f;watch.html">watch</a></li><li><a style="margin-left:0;" class="" href="&#x2f;watchman&#x2f;docs&#x2f;cmd&#x2f;watch-del.html">watch-del</a></li><li><a style="margin-left:0;" class="" href="&#x2f;watchman&#x2f;docs&#x2f;cmd&#x2f;watch-list.html">watch-list</a></li></ul></div><div class="nav-docs-section"><h3>Queries</h3><ul><li><a style="margin-left:0;" class="" href="&#x2f;watchman&#x2f;docs&#x2f;clockspec.html">Clockspec</a></li><li><a style="margin-left:0;" class="" href="&#x2f;watchman&#x2f;docs&#x2f;file-query.html">File Queries</a></li><li><a style="margin-left:0;" class="" href="&#x2f;watchman&#x2f;docs&#x2f;simple-query.html">Simple Pattern Syntax</a></li></ul></div><div class="nav-docs-section"><h3>Internals</h3><ul><li><a style="margin-left:0;" class="" href="&#x2f;watchman&#x2f;docs&#x2f;bser.html">BSER Binary Protocol</a></li><li><a style="margin-left:0;" class="" href="&#x2f;watchman&#x2f;docs&#x2f;casefolding.html">Case-Insensitivity</a></li><li><a style="margin-left:0;" class="" href="&#x2f;watchman&#x2f;contributing.html">Contributing</a></li><li><a style="margin-left:0;" class="" href="&#x2f;watchman&#x2f;docs&#x2f;cookies.html">Query Synchronization</a></li></ul></div><div class="nav-docs-section"><h3>Troubleshooting</h3><ul><li><a style="margin-left:0;" class="active" href="&#x2f;watchman&#x2f;docs&#x2f;troubleshooting.html">Troubleshooting</a></li></ul></div></div><div class="inner-content"><h1>Troubleshooting</h1><div><p>If you&#x27;ve been directed to this page due to an error or warning output from
Watchman, it typically means that there is some system tuning that you need to
perform.</p><h2><a class="anchor" name="recrawl"></a>Recrawl <a class="hash-link" href="#recrawl">#</a></h2><p>A recrawl is an action that Watchman performs in order to recover from
situations where it believes that it has lost sync with the state of the
filesystem.</p><p>The most common cause for a recrawl is on Linux systems where the default
inotify limits are sized quite small.  What this means is that the rate at
which your watched roots are generating changes is higher than the kernel can
buffer and relay to the watchman service.  When this happens, the kernel
detects the overflow and signals <code>IN_Q_OVERFLOW</code>.  The recovery is to
recursively scan the root to make sure that we know what is really there and
re-sync with the notification stream.</p><p>Frequent recrawls are undesirable because they result in a potentially
expensive full tree crawl, which marks all files as changed and propagates this
status to clients which will in turn perform some action on the (likely
falsely) changed state of the majority of files.</p><h3><a class="anchor" name="avoiding-recrawls"></a>Avoiding Recrawls <a class="hash-link" href="#avoiding-recrawls">#</a></h3><p>There is no simple formula for setting your system limits; bigger is better but
comes at the cost of kernel memory to maintain the buffers.  You and&#x2f;or your
system administrator should review the workload for your system and the
<a href="&#x2f;watchman&#x2f;docs&#x2f;install.html#system-specific-preparation" target="">System Specific Preparation Documentation</a> and raise your limits
accordingly.</p><h3><a class="anchor" name="i-ve-changed-my-limits-how-can-i-clear-the-warning"></a>I&#x27;ve changed my limits, how can I clear the warning? <a class="hash-link" href="#i-ve-changed-my-limits-how-can-i-clear-the-warning">#</a></h3><p>The warning will stick until you cancel the watch and reinstate it, or restart
the watchman process.  The simplest resolution is to run <code>watchman
shutdown-server</code> and re-establish your watch on your next watchman query.</p><h2><a class="anchor" name="where-are-the-logs"></a>Where are the logs? <a class="hash-link" href="#where-are-the-logs">#</a></h2><p>If you configured watchman using <code>--enable-statedir=&lt;STATEDIR&gt;</code> the
default location for logfile will be <code>&lt;STATEDIR&gt;&#x2f;&lt;USER&gt;.log</code>, otherwise it
will be <code>&lt;TMPDIR&gt;&#x2f;.watchman.&lt;USER&gt;.log</code>.</p><p>This location is overridden by the <code>--logfile</code> <a href="&#x2f;watchman&#x2f;docs&#x2f;cli-options.html#server-options" target="">Server Option</a>.</p><p><a href="&#x2f;watchman&#x2f;docs&#x2f;cli-options.html#quick-note-on-default-locations" target="">Quick note on default locations</a> explains what
we mean by <code>&lt;TMPDIR&gt;</code>, <code>&lt;USER&gt;</code> and so on.</p><h2><a class="anchor" name="poison-inotify-add-watch"></a>Poison: inotify_add_watch <a class="hash-link" href="#poison-inotify-add-watch">#</a></h2><div class="prism language-javascript">A non<span class="token operator">-</span>recoverable condition has triggered<span class="token punctuation">.</span>  Watchman needs your help<span class="token operator">!</span>
The triggering condition was at timestamp<span class="token operator">=</span><span class="token number">1407695600</span><span class="token punctuation">:</span> inotify<span class="token operator">-</span>add<span class="token operator">-</span><span class="token function">watch<span class="token punctuation">(</span></span><span class="token operator">&#x2f;</span>my<span class="token operator">&#x2f;</span>path<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Cannot allocate memory
All requests will <span class="token keyword">continue</span> to fail <span class="token keyword">with</span> <span class="token keyword">this</span> message until you resolve
the underlying problem<span class="token punctuation">.</span>  You will find more information on fixing <span class="token keyword">this</span> at
https<span class="token punctuation">:</span><span class="token operator">&#x2f;</span><span class="token operator">&#x2f;</span>facebook<span class="token punctuation">.</span>github<span class="token punctuation">.</span>io<span class="token operator">&#x2f;</span>watchman<span class="token operator">&#x2f;</span>troubleshooting<span class="token punctuation">.</span>html#poison<span class="token operator">-</span>inotify<span class="token operator">-</span>add<span class="token operator">-</span>watch</div><p>If you&#x27;ve encountered this state it means that your <em>kernel</em> was unable to
watch a dir in one or more of the roots you&#x27;ve asked it to watch.  This
particular condition is considered non-recoverable by Watchman on the basis
that nothing that the Watchman service can do can guarantee that the root cause
is resolved, and while the system is in this state, Watchman cannot guarantee
that it can respond with the correct results that its clients depend upon.  We
consider ourselves poisoned and will fail all requests for all watches (not
just the watch that it triggered on) until the process is restarted.</p><p>There are two primary reasons that this can trigger:</p><ul><li>The user limit on the total number of inotify watches was reached or the
kernel failed to allocate a needed resource</li><li>Insufficient kernel memory was available</li></ul><p>The resolution for the former is to revisit
<a href="&#x2f;watchman&#x2f;docs&#x2f;install.html#system-specific-preparation" target="">System Specific Preparation Documentation</a> and raise your limits
accordingly.</p><p>The latter condition implies that your workload is exceeding the available RAM
on the machine.  It is difficult to give specific advice to resolve this
condition here; you may be able to tune down other system limits to free up
some resources, or you may just need to install more RAM in the system.</p><h3><a class="anchor" name="i-ve-changed-my-limits-how-can-i-clear-the-error"></a>I&#x27;ve changed my limits, how can I clear the error? <a class="hash-link" href="#i-ve-changed-my-limits-how-can-i-clear-the-error">#</a></h3><p>The error will stick until you restart the watchman process.  The simplest
resolution is to run <code>watchman shutdown-server</code>.</p><p>If you have not actually resolved the root cause you may continue to trigger
and experience this state each time the system trips over these limits.</p></div><div class="docs-prevnext"></div></div></section><footer class="wrap"><div class="right">Â© 2012-2014 Facebook Inc.</div></footer></div><div id="fb-root"></div><script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
            ga('create', 'UA-387204-10', 'facebook.github.io');
            ga('send', 'pageview');

            !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)
            ){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";
            fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
          </script></body></html>