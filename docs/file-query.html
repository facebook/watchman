<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>watchman | A file watching service</title><meta name="viewport" content="width=device-width"><meta property="og:title" content="watchman | A file watching service"><meta property="og:type" content="website"><meta property="og:url" content="http://facebook.github.io/watchman/index.html"><meta property="og:image" content="http://facebook.github.io/watchman/img/favicon.png"><meta property="og:description" content="A file watching service"><link rel="shortcut icon" href="/watchman/img/favicon.png"><link rel="stylesheet" href="/watchman/css/watchman.css"><script type="text/javascript" src="//use.typekit.net/vqa1hcx.js"></script><script type="text/javascript">try{Typekit.load();}catch(e){}</script></head><body><div class="container"><div class="nav-main"><div class="wrap"><a class="nav-home" href="/watchman/">watchman</a><ul class="nav-site"><li><a href="/watchman/docs/install.html" class="active">docs</a></li><li><a href="/watchman/support.html" class="">support</a></li><li><a href="http://github.com/facebook/watchman" class="">github</a></li></ul></div></div><section class="content wrap documentationContent"><div class="nav-docs"><div class="nav-docs-section"><h3>Installation</h3><ul><li><a style="margin-left:0;" class="" href="/watchman/docs/install.html">Installation</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/release-notes.html">Release Notes</a></li></ul></div><div class="nav-docs-section"><h3>Invocation</h3><ul><li><a style="margin-left:0;" class="" href="/watchman/docs/cli-options.html">Command Line</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/config.html">Configuration Files</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/socket-interface.html">Socket Interface</a></li></ul></div><div class="nav-docs-section"><h3>Compatibility</h3><ul><li><a style="margin-left:0;" class="" href="/watchman/docs/compatibility.html">Compatibility Rules</a></li></ul></div><div class="nav-docs-section"><h3>Commands</h3><ul><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/clock.html">clock</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/find.html">find</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/get-config.html">get-config</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/get-sockname.html">get-sockname</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/log.html">log</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/log-level.html">log-level</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/query.html">query</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/shutdown-server.html">shutdown-server</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/since.html">since</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/subscribe.html">subscribe</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/trigger.html">trigger</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/trigger-del.html">trigger-del</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/trigger-list.html">trigger-list</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/unsubscribe.html">unsubscribe</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/version.html">version</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/watch.html">watch</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/watch-del.html">watch-del</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/watch-del-all.html">watch-del-all</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/watch-list.html">watch-list</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cmd/watch-project.html">watch-project</a></li></ul></div><div class="nav-docs-section"><h3>Queries</h3><ul><li><a style="margin-left:0;" class="" href="/watchman/docs/clockspec.html">Clockspec</a></li><li><a style="margin-left:0;" class="active" href="/watchman/docs/file-query.html">File Queries</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/simple-query.html">Simple Pattern Syntax</a></li></ul></div><div class="nav-docs-section"><h3>Expression Terms</h3><ul><li><a style="margin-left:0;" class="" href="/watchman/docs/expr/allof.html">allof</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/expr/anyof.html">anyof</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/expr/dirname.html">dirname &amp; idirname</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/expr/empty.html">empty</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/expr/exists.html">exists</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/expr/false.html"></a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/expr/match.html">match &amp; imatch</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/expr/name.html">name &amp; iname</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/expr/not.html">not</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/expr/pcre.html">pcre &amp; ipcre</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/expr/since.html">since</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/expr/size.html">size</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/expr/suffix.html">suffix</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/expr/true.html"></a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/expr/type.html">type</a></li></ul></div><div class="nav-docs-section"><h3>Internals</h3><ul><li><a style="margin-left:0;" class="" href="/watchman/docs/bser.html">BSER Binary Protocol</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/casefolding.html">Case-Insensitivity</a></li><li><a style="margin-left:0;" class="" href="/watchman/contributing.html">Contributing</a></li><li><a style="margin-left:0;" class="" href="/watchman/docs/cookies.html">Query Synchronization</a></li></ul></div><div class="nav-docs-section"><h3>Troubleshooting</h3><ul><li><a style="margin-left:0;" class="" href="/watchman/docs/troubleshooting.html">Troubleshooting</a></li></ul></div></div><div class="inner-content"><h1>File Queries</h1><div><p>Watchman file queries consist of 1 or more <em>generators</em> that feed files through
the <em>expression evaluator</em>.</p><h3><a class="anchor" name="generators"></a>Generators <a class="hash-link" href="#generators">#</a></h3><p>Generators are analogous to the list of <em>paths</em> that you specify when using the
<code>find(1)</code> utility, but are implemented in watchman with a bit of a twist
because watchman doesn&#x27;t need to crawl the filesystem in realtime and instead
maintains a couple of indexes over the tree.</p><p>A query may specify any number of generators; each generator will emit its list
of files and this may mean that you see the same file output more than once if
you specified the use of multiple generators that all produce the same file.</p><p>Watchman provides 4 generators:</p><ul><li><strong>since</strong>: produces a list of files that were modified since a specific
clockspec.</li><li><strong>suffix</strong>: produces a list of files that have a particular suffix.</li><li><strong>path</strong>: produces a list of files based on their path and depth.</li><li><strong>all</strong>: produces a list of all known files</li></ul><h4><a class="anchor" name="since-generator"></a>Since Generator <a class="hash-link" href="#since-generator">#</a></h4><p>The <code>since</code> generator produces a list of files that were modified since a
specific <a href="../docs/clockspec.html" target="_blank">clockspec</a>.</p><p>The following query will consider the set of files changed since the last
query using the named cursor <code>mycursor</code> and then pass them to the expression
evaluator to be filtered to just those that are files:</p><div class="prism language-javascript">$ watchman <span class="token operator">-</span>j &lt;&lt;<span class="token operator">-</span>EOT
<span class="token punctuation">[</span><span class="token string">&quot;query&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/path/to/root&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;since&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;n:mycursor&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;expression&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;f&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span>
EOT</div><p>If the <code>since</code> parameter value is blank, was produced by a different watchman
process (in other words, the watchman process was restarted between the time
that the value was obtained and the time the query was issued) or is a named
cursor that has not yet been used in a query, the <code>since</code> generator will
consider the state to be a <em>fresh instance</em> and its behavior is modified:</p><p>A <em>fresh instance</em> result set will only include files that currently exist
and will generate file nodes that are always considered to be <code>new</code>.</p><p>If the query was configured with the <code>empty_on_fresh_instance</code> property set to
<code>true</code> then the result set will be empty and the <code>is_fresh_instance</code> property
will be set to <code>true</code> in the result object.</p><h4><a class="anchor" name="suffix-generator"></a>Suffix Generator <a class="hash-link" href="#suffix-generator">#</a></h4><p>The <code>suffix</code> generator produces a list of files that have a particular suffix
or set of suffixes.  The value can be either a string or an array of strings.</p><div class="prism language-javascript">$ watchman <span class="token operator">-</span>j &lt;&lt;<span class="token operator">-</span>EOT
<span class="token punctuation">[</span><span class="token string">&quot;query&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/path/to/root&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;suffix&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;js&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span>
EOT</div><div class="prism language-javascript">$ watchman <span class="token operator">-</span>j &lt;&lt;<span class="token operator">-</span>EOT
<span class="token punctuation">[</span><span class="token string">&quot;query&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/path/to/root&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;suffix&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;js&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;css&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span>
EOT</div><h4><a class="anchor" name="path-generator"></a>Path Generator <a class="hash-link" href="#path-generator">#</a></h4><p>The <code>path</code> generator produces a list of files based on their path and depth.
Depth controls how far watchman will search down the directory tree for files.</p><p>The <code>path</code> generator expects an array of path specifiers.  Each path specifier
can be either a string or an object and each will produce a set of files.</p><p>If it is a string then it is treated as the value for <code>path</code> with <code>depth</code> set
to infinite.  If an object, the fields <code>path</code> (a string) and <code>depth</code> (an
integer) must be supplied.</p><p>Paths are relative to the root, so if watchman is watching <code>/foo/</code>, path <code>bar</code>
refers to <code>/foo/bar</code>.</p><p>A <code>depth</code> value of <code>0</code> means only files and directories which are contained in
this path.  A <code>depth</code> value of <code>-1</code> means no limit on the depth.</p><p>The following <code>path</code> generators are equivalent:</p><div class="prism language-javascript">$ watchman <span class="token operator">-</span>j &lt;&lt;<span class="token operator">-</span>EOT
<span class="token punctuation">[</span><span class="token string">&quot;query&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/path/to/root&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;path&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;bar&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span>
EOT</div><div class="prism language-javascript">$ watchman <span class="token operator">-</span>j &lt;&lt;<span class="token operator">-</span>EOT
<span class="token punctuation">[</span><span class="token string">&quot;query&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/path/to/root&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;path&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;depth&quot;</span><span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span>
EOT</div><h4><a class="anchor" name="all-generator"></a>All Generator <a class="hash-link" href="#all-generator">#</a></h4><p>The <code>all</code> generator produces a list of all file nodes.  It is the default
generator and is used in the case where no other generators were explicitly
specified.</p><div class="prism language-javascript">$ watchman <span class="token operator">-</span>j &lt;&lt;<span class="token operator">-</span>EOT
<span class="token punctuation">[</span><span class="token string">&quot;query&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/path/to/root&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span>
EOT</div><h3><a class="anchor" name="expressions"></a>Expressions <a class="hash-link" href="#expressions">#</a></h3><p>A watchman query expression consists of 0 or more expression terms.  If no
terms are provided then each file evaluated is considered a match (equivalent
to specifying a single <code>true</code> expression term).</p><p>Otherwise, the expression is evaluated against the file and produces a boolean
result.  If that result is true then the file is considered a match and is
added to the output set.</p><p>An expression term is canonically represented as a JSON array whose zeroth
element is a string containing the term name.</p><div class="prism language-javascript"><span class="token punctuation">[</span><span class="token string">&quot;termname&quot;</span><span class="token punctuation">,</span> arg1<span class="token punctuation">,</span> arg2<span class="token punctuation">]</span></div><p>If the term accepts no arguments you may use a short form that consists of just
the term name expressed as a string:</p><div class="prism language-javascript"><span class="token string">&quot;true&quot;</span></div><p>Expressions that match against file names may match against either the
<em>basename</em> or the <em>wholename</em> of the file.  The basename is the name of the
file within its containing directory.  The wholename is the name of the file
relative to the watched root.</p><p>You can find a list of all possible expression terms in the sidebar on the left
of this page.</p><h3><a class="anchor" name="relative-roots"></a>Relative roots <a class="hash-link" href="#relative-roots">#</a></h3><p><em>Since 3.3.</em></p><p>Watchman supports optionally evaluating queries with respect to a path within a
watched root. This is used with the <code>relative_root</code> parameter:</p><div class="prism language-javascript"><span class="token punctuation">[</span><span class="token string">&quot;query&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/path/to/watched/root&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;relative_root&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;project1&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span></div><p>Setting a relative root results in the following modifications to queries:</p><ul><li>The <code>path</code> generator is evaluated with respect to the relative root. In the
above example, <code>&quot;path&quot;: [&quot;dir&quot;]</code> will return all files inside
<code>/path/to/watched/root/project1/dir</code>.</li><li>The input expression is evaluated with respect to the relative root. In the
above example, <code>&quot;expression&quot;: [&quot;match&quot;, &quot;dir/*.txt&quot;, &quot;wholename&quot;]</code> will return
all files inside <code>/path/to/watched/root/project1/dir/</code> that match the glob
<code>*.txt</code>.</li><li>Paths inside the relative root are returned with the relative root stripped
off. For example, a path <code>project1/dir/file.txt</code> would be returned as
<code>dir/file.txt</code>.</li><li>Paths outside the relative root are not returned.</li></ul><p>Relative roots behave similarly to a separate Watchman watch on the
subdirectory, without any of the system overhead that that imposes. This is
useful for large repositories, where your script or tool is only interested in a
particular directory inside the repository.</p></div><div class="docs-prevnext"></div></div></section><footer class="wrap"><div class="right">Â© 2012-2015 Facebook Inc.</div></footer></div><div id="fb-root"></div><script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
            ga('create', 'UA-387204-10', 'facebook.github.io');
            ga('send', 'pageview');

            !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)
            ){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";
            fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
          </script></body></html>